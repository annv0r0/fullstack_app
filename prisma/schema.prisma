datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Item {
  id          String    @id @default(cuid())
  userId      String    
  article     String    @unique
  title       String
  description String?
  weight      Int?
  unit        String?
  price       Decimal?  @db.Decimal(10, 2)
  available   Boolean?
  rating      Int?
  image       String?
  date        DateTime? @default(now())

  cartItems CartItem[]
  orderItems OrderItem[]

  @@index([userId])
}

model Cart {
  id        String     @id @default(cuid())
  userId    String?    @unique
  items     CartItem[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model CartItem {
  id        String  @id @default(cuid())
  cartId    String
  productId String
  quantity  Int     @default(1)
  title     String
  price     Decimal @db.Decimal(10, 2)
  image     String?

  cart    Cart  @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product Item? @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@unique([cartId, productId])
}

model Order {
  id        String       @id @default(cuid())
  userId    String?
  subtotal  Decimal      @db.Decimal(10, 2)
  discount  Decimal      @db.Decimal(10, 2) @default(0)
  total     Decimal      @db.Decimal(10, 2)
  status    OrderStatus  @default(PAID)
  items     OrderItem[]
  createdAt DateTime     @default(now())
}

model OrderItem {
  id        String   @id @default(cuid())
  orderId   String
  productId String?
  title     String
  price     Decimal  @db.Decimal(10, 2)
  quantity  Int
  currency  String       @default("USD")
  image     String?

  order   Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Item? @relation(fields: [productId], references: [id], onDelete: SetNull)
}

enum OrderStatus {
  PENDING
  PAID
  FAILED
  CANCELLED
  REFUNDED
}